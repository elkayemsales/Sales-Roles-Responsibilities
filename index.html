<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sales Team Roles & Responsibilities</title>
<link rel="icon" type="image/x-icon" href="favicon.png">
<style>
/* ... (Existing CSS remains the same) ... */
* { box-sizing:border-box; margin:0; padding:0; }
body, html { font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif; background:#fff9f4; color:#4b433b; }

/* --- Fixed Controls --- */
#sidebarToggleBtn { position:fixed; top:16px; right:16px; z-index:1600; padding:12px 16px; border-radius:50px; cursor:pointer; background:#e9dcca; font-weight:700; }
#viewToggleBtn { position:fixed; top:16px; right:90px; z-index:1600; padding:12px 16px; border-radius:50px; cursor:pointer; background:#d9c6a2; font-weight:700; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
#backToTop { position:fixed; bottom:30px; right:30px; padding:12px 16px; background:#e9dcca; border-radius:50px; cursor:pointer; display:none; z-index:1700; font-weight:700; }

/* --- Sidebar & Main Content --- */
#sidebar { 
    position:fixed; top:0; left:0; bottom:0; width:320px; max-width:90%; 
    background:#f7efe6; padding:20px; border-right:1px solid #d7c6a6; 
    border-radius:0 10px 10px 0; display:flex; flex-direction:column; 
    gap:12px; transform:translateX(-100%); transition:transform .28s ease; 
    z-index:1500; overflow-y:auto; 
}
#sidebar.open { transform:translateX(0); }

#main { padding:28px; transition:margin-left .28s ease; }
#main.shifted { margin-left:320px; }
h1 { font-size:1.8rem; margin-bottom:12px; color:#6b5e4a; }

/* --- Card Styling --- */
.employee-card { background:#f3e9d6; border-radius:14px; padding:18px; margin-bottom:22px; box-shadow:0 3px 10px rgba(107,94,74,0.1); }
.employee-top { display:flex; gap:16px; align-items:center; }
/* IMAGE STYLE 1: Main Employee Image */
.employee-top img { 
    width:90px; height:90px; border-radius:12px; 
    object-fit:cover; /* *** ENSURES CROP TO FIT *** */
    border:3px solid #d7c6a6; background:#f8f4ed; flex-shrink:0; 
    cursor: pointer; 
}
.employee-top .meta { display:flex; flex-direction:column; gap:5px; }
.employee-top h3 { margin:0; font-size:1.15rem; font-weight:700; }
.employee-top .code { font-weight:700; font-size:.96rem; }
.employee-top small { color:#8b7b5a; font-weight:600; }
.customer-follow { margin-top:10px; background:#e3f5e3; border-left:4px solid #5ca65c; padding:8px 10px; border-radius:8px; }
.customer-follow strong { display:block; margin-bottom:6px; color:#2f6b2f; }
.customer-chip { display:inline-block; margin:4px 6px 0 0; background:#c4edc4; color:#2f6b2f; padding:4px 8px; border-radius:8px; font-weight:600; font-size:.9rem; }
.authorities { margin-top:10px; background:#fff4d6; border-left:4px solid #d9b65b; padding:8px 10px; border-radius:8px; display:flex; gap:8px; flex-wrap:wrap; }
.authority-chip { background:#f9e4a9; padding:6px 8px; border-radius:8px; font-weight:600; font-size:.88rem; }
.children-wrap { margin-top:12px; display:flex; flex-direction:column; gap:10px; }
.child-block { background:#fffef7; border:1.2px solid #e6dbc3; padding:10px; border-radius:10px; display:flex; flex-direction:column; gap:8px; }
.child-top { display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }
.resp { font-weight:700; }
.contrib { font-size:.92rem; color:#8b7b5a; font-weight:600; background:#f2e9d3; padding:6px 8px; border-radius:8px; }
.secondline-row { display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; }
.secondline-chip { display:flex; align-items:flex-start; gap:10px; background:#fff; border:1px solid #d7c6a6; padding:8px 10px; border-radius:10px; min-width:160px; flex:1 1 auto; flex-direction:row; }
/* IMAGE STYLE 2: Second-Line Image */
.secondline-chip img { 
    width:52px; height:52px; border-radius:10px; 
    object-fit:cover; /* *** ENSURES CROP TO FIT *** */
    border:2px solid #d7c6a6; background:#f7f1e8; 
    cursor: pointer; 
}
.sname { font-weight:700; color:#5b4e3d; }
.smeta { font-size:.84rem; color:#8b7b5a; }

/* --- Filtering UI --- */
.filter-btn { background:#fef8f3; border:1.6px solid #d7c6a6; padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600; text-align:left; display:block; margin-bottom:6px; width:100%; }
.filter-btn.active { background:#b3a17a; color:#fff9f4; border-color:#9b8958; box-shadow:0 4px 10px #9b895822; }
#clearFilterBtn { background:#f2d1a9; border:0; padding:10px; width:100%; border-radius:10px; font-weight:700; cursor:pointer; margin-bottom:12px; }
#clearFilterBtn:disabled { opacity:0.55; cursor:not-allowed; }
#filterInput { width:100%; padding:10px; border-radius:10px; border:1.6px solid #d7c6a6; margin-bottom:12px; background:#fff4e6; color:#4b433b; }
.filter-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.filter-header h2 { font-size:1rem; color:#6b5e4a; margin:0; }
.clear-individual-btn { 
    background: #d7c6a6; color: #fff; border: none; border-radius: 5px; 
    padding: 2px 6px; font-size: 0.8rem; font-weight: 700; cursor: pointer;
    line-height: 1; 
}
.clear-individual-btn:disabled { 
    background: #e9e5de; cursor: not-allowed; 
}

/* --- Image Modal Styles --- */
#imageModal {
    display: none; 
    position: fixed; 
    z-index: 5000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0,0,0,0.85); 
    align-items: center;
    justify-content: center;
    pointer-events: none; 
}
#imageModal.visible {
    display: flex;
    pointer-events: auto; 
}
#modalContent {
    width: 90%;
    max-width: 700px;
    max-height: 90vh; 
    object-fit: contain; 
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    background: #fff; 
    pointer-events: auto; 
}

/* --- NEW PDF Viewer Modal Styles --- */
#pdfModal {
    display: none;
    position: fixed;
    z-index: 6000; /* Higher than image modal */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.9);
    align-items: center;
    justify-content: center;
}
#pdfModal.visible {
    display: flex;
}
#pdfContent {
    width: 90%;
    height: 90%;
    max-width: 1000px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}
#pdfHeader {
    padding: 12px 20px;
    background: #6b5e4a;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
}
#pdfCloseBtn {
    background: none;
    border: none;
    color: #fff;
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
    padding: 0 5px;
}
#pdfViewer {
    flex-grow: 1;
    width: 100%;
    border: none;
}

/* R&R Button Style (for consistency) */
.rr-toggle-btn {
    background: #d9b65b; /* A prominent theme color */
    color: #fff9f4;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 10px;
    display: inline-block;
    transition: background-color 0.2s;
}
.rr-toggle-btn:hover {
    background: #c7a44f;
}

</style>
</head>
<body>

<button id="viewToggleBtn">üîç **Basic**</button>
<button id="sidebarToggleBtn">‚ò∞</button>

<aside id="sidebar">
  <input id="filterInput" type="search" placeholder="Search name, code, dept, customer...">
  <button id="clearFilterBtn" disabled>Clear ALL filters</button>
  
  <div class="filter-block">
    <div class="filter-header">
      <h2>Filter by Customer (Multi-Select)</h2>
      <button id="clearCustomerBtn" class="clear-individual-btn" disabled>‚ùå</button>
    </div>
    <div id="customerFilters"></div>
  </div>
  
  <div class="filter-block">
    <div class="filter-header">
      <h2>Filter by Role (Single-Select) </h2>
      <button id="clearRoleBtn" class="clear-individual-btn" disabled>‚ùå</button>
    </div>
    <div id="roleFilters"></div>
  </div>
  
  <div class="filter-block">
    <div class="filter-header">
      <h2>Filter by Contribution (Multi-Select)</h2>
      <button id="clearContribBtn" class="clear-individual-btn" disabled>‚ùå</button>
    </div>
    <div id="contribFilters"></div>
  </div>
</aside>

<main id="main">
  <h1>Sales Team Roles & Responsibilities</h1>
  <div id="contentArea"></div>
</main>

<div id="imageModal">
    <img id="modalContent" alt="Employee Photo">
</div>

<div id="pdfModal">
    <div id="pdfContent">
        <div id="pdfHeader">
            <span id="pdfTitle">Roles & Responsibilities Document</span>
            <button id="pdfCloseBtn">&times;</button>
        </div>
        <iframe id="pdfViewer" title="R&R Document Viewer"></iframe>
    </div>
</div>

<button id="backToTop">Back to Top ‚Üë</button>

<script>
const sidebarBtn = document.getElementById('sidebarToggleBtn');
const sidebar = document.getElementById('sidebar');
const contentArea = document.getElementById('contentArea');
const roleFiltersDiv = document.getElementById('roleFilters');
const contribFiltersDiv = document.getElementById('contribFilters');
const customerFiltersDiv = document.getElementById('customerFilters');
const filterInput = document.getElementById('filterInput');
const clearBtn = document.getElementById('clearFilterBtn'); 
const clearRoleBtn = document.getElementById('clearRoleBtn');
const clearCustomerBtn = document.getElementById('clearCustomerBtn');
const clearContribBtn = document.getElementById('clearContribBtn');
const backToTop = document.getElementById('backToTop');
const viewToggleBtn = document.getElementById('viewToggleBtn');
const main = document.getElementById('main');

// Image Modal Elements
const imageModal = document.getElementById('imageModal');
const modalContent = document.getElementById('modalContent');

// PDF Modal Elements (NEW)
const pdfModal = document.getElementById('pdfModal');
const pdfViewer = document.getElementById('pdfViewer');
const pdfTitle = document.getElementById('pdfTitle');
const pdfCloseBtn = document.getElementById('pdfCloseBtn');


let data=[], activeRole=null, activeContrib=[], activeCustomer=[], basicView=true; 
let nameIndex=new Map();

// --- Global Variable for Hover Delay ---
let hoverTimer = null; 
const HOVER_DELAY_MS = 200; 

// --- General Modal Handlers ---

function closeImageModal() {
    imageModal.classList.remove('visible');
    imageModal.style.display = 'none'; 
}

function closePdfModal() {
    pdfModal.classList.remove('visible');
    pdfModal.style.display = 'none';
    pdfViewer.src = ''; // Clear the iframe content
}

// Close image modal on click outside content
imageModal.addEventListener('click', (e) => {
    if (e.target === imageModal) {
        closeImageModal();
    }
});

// Close image modal when the mouse leaves the large image
modalContent.addEventListener('mouseleave', closeImageModal);

// Close PDF modal on backdrop click
pdfModal.addEventListener('click', (e) => {
    if (e.target === pdfModal) {
        closePdfModal();
    }
});

// Close PDF modal via button
pdfCloseBtn.onclick = closePdfModal;

// Close any modal on Escape key press
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (imageModal.classList.contains('visible')) {
            closeImageModal();
        }
        if (pdfModal.classList.contains('visible')) {
            closePdfModal();
        }
    }
});

// --- NEW PDF Viewer Logic ---

function openPdfViewer(employeeCode, employeeName) {
    // Construct the URL: R&R folder + Employee Code + .pdf extension
    const pdfUrl = `R&R/${employeeCode}.pdf`; 
    
    pdfTitle.textContent = `R&R Document: ${employeeName} (${employeeCode})`;
    pdfViewer.src = pdfUrl;

    pdfModal.classList.add('visible');
    pdfModal.style.display = 'flex';
}

// --- R&R Button Click Handler (Now opens PDF) ---
function handleRRButtonClick(employeeCode, employeeName) {
    openPdfViewer(employeeCode, employeeName);
}

// --- Event Listeners for Controls (existing) ---
// Sidebar toggle
sidebarBtn.onclick = ()=>{
  sidebar.classList.toggle('open'); 
  main.classList.toggle('shifted');
};

// Back to Top button
window.addEventListener('scroll',()=>{ backToTop.style.display = window.scrollY>200?'block':'none'; });
backToTop.onclick = ()=>{ window.scrollTo({ top:0, behavior:'smooth' }); };

// View toggle (The Expanded view logic is now redundant since R&R is in a popup, 
// but we keep the toggle button to handle the old inline AUTHORITIES/CHILDREN view if desired)
viewToggleBtn.onclick = ()=>{
  basicView = !basicView;
  viewToggleBtn.innerHTML = basicView ? 'üîç **Basic**' : 'üìÇ **Expanded**';
  render();
};
viewToggleBtn.innerHTML = basicView ? 'üîç **Basic**' : 'üìÇ **Expanded**';

// Clear ALL filters button
clearBtn.onclick = ()=>{ 
  activeRole=null; 
  activeContrib=[]; 
  activeCustomer=[]; 
  filterInput.value=''; 
  updateUI(); 
  render(); 
};

// Clear Individual Filter buttons
clearRoleBtn.onclick = ()=>{ activeRole=null; updateUI(); render(); };
clearCustomerBtn.onclick = ()=>{ activeCustomer=[]; updateUI(); render(); };
clearContribBtn.onclick = ()=>{ activeContrib=[]; updateUI(); render(); };


// --- Data and Rendering Logic (existing functions) ---
const customRoleOrder = {
  'HEAD OF THE DEPARTMENT': 1,
  'SR.OFFICER': 2,
  'OFFICER': 3,
  'JR.OFFICER': 4,
  'OPERATOR': 5,
  'AD.OPERATOR': 6,
  'AD.TRAINEE': 7
};
async function loadJSON(){
  const res = await fetch('Data.json');
  data = await res.json();
  // ... (Custom Sorting Logic remains the same) ...
  data.sort((a, b) => {
    const roleA = (a.ROLES || '').toUpperCase();
    const roleB = (b.ROLES || '').toUpperCase();
    const rankA = customRoleOrder[roleA] || 999;
    const rankB = customRoleOrder[roleB] || 999;

    if (rankA !== rankB) {
      return rankA - rankB;
    }

    const codeA = (a.EMPLOYEE_CODE || '').toUpperCase();
    const codeB = (b.EMPLOYEE_CODE || '').toUpperCase();
    if (codeA < codeB) return -1;
    if (codeA > codeB) return 1;
    
    return 0;
  });

  data.forEach(d=>{
    if(!Array.isArray(d.AUTHORITIES)) d.AUTHORITIES = d.AUTHORITIES ? [d.AUTHORITIES] : [];
    if(!Array.isArray(d.CHILDREN)) d.CHILDREN = d.CHILDREN||[];
    if(!Array.isArray(d.CUSTOMER)) d.CUSTOMER = d.CUSTOMER ? (Array.isArray(d.CUSTOMER)?d.CUSTOMER:[d.CUSTOMER]) : [];
    nameIndex.set((d.EMPLOYEE_NAME||'').toLowerCase(), d);
  });
  buildFilters();
  render();
}
function buildFilters(){
  // ... (Build filters logic remains the same) ...
  // Roles (Single Select)
  const roles=[...new Set(data.map(d=>d.ROLES).filter(Boolean))];
  roleFiltersDiv.innerHTML='';
  roles.forEach(r=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=r;
    b.onclick=()=>{ activeRole = activeRole===r?null:r; updateUI(); render(); };
    roleFiltersDiv.appendChild(b);
  });

  // Contribution (Multi Select)
  const contribs=[...new Set(data.flatMap(d=>d.CHILDREN.map(c=>c['SALES ACTIVITIES CONTRIBUTION']).filter(Boolean)))];
  contribFiltersDiv.innerHTML='';
  contribs.forEach(c=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
    b.onclick=()=>{ 
      toggleSelection(activeContrib, c);
      updateUI(); 
      render(); 
    };
    contribFiltersDiv.appendChild(b);
  });

  // Customers (Multi Select)
  const custSet=new Set();
  data.forEach(d=>{
    d.CUSTOMER.forEach(c=>{
      c.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>custSet.add(s));
    });
  });
  customerFiltersDiv.innerHTML='';
  Array.from(custSet).sort().forEach(c=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
    b.onclick=()=>{ 
      toggleSelection(activeCustomer, c);
      updateUI(); 
      render(); 
    };
    customerFiltersDiv.appendChild(b);
  });

  updateUI();
}
function toggleSelection(arr, item) {
  const index = arr.indexOf(item);
  if (index > -1) {
    arr.splice(index, 1);
  } else {
    arr.push(item);
  }
}
function updateUI(){
  // ... (Update UI logic remains the same) ...
  // Update filter button visual states
  [...roleFiltersDiv.children].forEach(b=>b.classList.toggle('active', b.textContent===activeRole));
  [...contribFiltersDiv.children].forEach(b=>b.classList.toggle('active', activeContrib.includes(b.textContent)));
  [...customerFiltersDiv.children].forEach(b=>b.classList.toggle('active', activeCustomer.includes(b.textContent)));
  
  // Update individual clear button states
  clearRoleBtn.disabled = !activeRole;
  clearCustomerBtn.disabled = activeCustomer.length === 0;
  clearContribBtn.disabled = activeContrib.length === 0;

  // Update 'Clear ALL' button state
  const isFilterActive = activeRole || activeCustomer.length > 0 || activeContrib.length > 0 || filterInput.value.trim().length > 0;
  clearBtn.disabled = !isFilterActive;
}

// --- RENDER FUNCTION (MODIFIED) ---
function render(){
  const q = filterInput.value.trim().toLowerCase();
  let visible = data.slice();
  
  // Apply filters... (Filter logic remains the same)
  if(activeRole) visible = visible.filter(d=>d.ROLES===activeRole);
  
  if(activeContrib.length > 0) {
    visible = visible.filter(d => 
      d.CHILDREN.some(c => activeContrib.includes(c['SALES ACTIVITIES CONTRIBUTION']))
    );
  }
  
  if(activeCustomer.length > 0) {
    visible = visible.filter(d => 
      d.CUSTOMER.some(citem => 
        citem.split(/[\/,;\|]+/).map(x => x.trim())
        .some(cName => activeCustomer.includes(cName))
      )
    );
  }
  
  // Apply text search filter
  if(q) visible = visible.filter(d=>{
    const top = (d.EMPLOYEE_NAME+' '+d.EMPLOYEE_CODE+' '+d.ROLES+' '+(d.DEPARTMENT||'')).toLowerCase();
    const auth = d.AUTHORITIES.some(a=>a.toLowerCase().includes(q));
    const child = d.CHILDREN.some(c=>((c.RESPONSIBILITIES||'')+' '+(c['SALES ACTIVITIES CONTRIBUTION']||'')).toLowerCase().includes(q));
    const cust = d.CUSTOMER.some(c=>c.toLowerCase().includes(q));
    return top.includes(q)||auth||child||cust;
  });

  contentArea.innerHTML='';
  if(!visible.length){ contentArea.innerHTML='<p>No matching records found.</p>'; return; }

  visible.forEach(emp=>{
    const card=document.createElement('div'); card.className='employee-card';
    const top=document.createElement('div'); top.className='employee-top';
    
    const imgURL = emp.EMPLOYEE_IMAGE;

    // 1. MAIN EMPLOYEE IMAGE: Only create image element if URL exists
    if (imgURL) {
        const img = document.createElement('img'); 
        img.src = imgURL; 
        img.alt = emp.EMPLOYEE_NAME;
        attachPreview(img, emp); 
        top.append(img); 
    }

    const meta=document.createElement('div'); meta.className='meta';
    
    // Append image metadata (name, code, role)
    meta.innerHTML = `<h3>${emp.EMPLOYEE_NAME}</h3><div class="code">${emp.EMPLOYEE_CODE||''}</div><small>${emp.ROLES||''}</small>`; 
    top.append(meta); 
    card.appendChild(top);

    if(emp.CUSTOMER.length){
      const cDiv=document.createElement('div'); cDiv.className='customer-follow';
      cDiv.innerHTML = '<strong>Customer Follow-ups:</strong>';
      emp.CUSTOMER.forEach(citem=>{
        citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{
          const chip=document.createElement('span'); chip.className='customer-chip'; chip.textContent=s; cDiv.appendChild(chip);
        });
      });
      card.appendChild(cDiv);
    }
    
    // --- NEW R&R Button (Triggers PDF) ---
    // The button remains, but the click handler is updated
    const hasDetails = emp.AUTHORITIES.length > 0 || emp.CHILDREN.length > 0;
    if (hasDetails) {
        const rrBtn = document.createElement('button');
        rrBtn.id = `rr-button-${emp.EMPLOYEE_CODE}`;
        rrBtn.className = 'rr-toggle-btn';
        rrBtn.textContent = 'R&R';
        // *** NEW CLICK HANDLER: Open PDF Viewer ***
        rrBtn.onclick = () => handleRRButtonClick(emp.EMPLOYEE_CODE, emp.EMPLOYEE_NAME);
        card.appendChild(rrBtn);
    }
    
    // --- Full view sections (Only shown when basicView is false) ---
    // We keep this legacy section for the "Expanded" view toggle, but it only shows authorities and children details inline.
    if(!basicView){
      if(emp.AUTHORITIES.length){
        const aDiv=document.createElement('div'); aDiv.className='authorities';
        emp.AUTHORITIES.forEach(a=>{ const chip=document.createElement('div'); chip.className='authority-chip'; chip.textContent=a; aDiv.appendChild(chip); });
        card.appendChild(aDiv);
      }
      if(emp.CHILDREN.length){
        const wrap=document.createElement('div'); wrap.className='children-wrap';
        emp.CHILDREN.forEach(child=>{
          if(child['SECONDLINE PERSON'] && child['SECONDLINE PERSON'].startsWith('****')) return;
          const cb=document.createElement('div'); cb.className='child-block';
          const ctop=document.createElement('div'); ctop.className='child-top';
          const resp=document.createElement('div'); resp.className='resp'; resp.textContent=child.RESPONSIBILITIES||'‚Äî';
          const contrib=document.createElement('div'); contrib.className='contrib'; contrib.textContent=child['SALES ACTIVITIES CONTRIBUTION']||'';
          ctop.append(resp, contrib); cb.appendChild(ctop);

          const secsRaw = (child['SECONDLINE PERSON']||'').split(/[\/,;\|]+/).map(s=>s.trim()).filter(Boolean);
          if(secsRaw.length){
            const row=document.createElement('div'); row.className='secondline-row';
            secsRaw.forEach(sec=>{
              const m = nameIndex.get((sec||'').toLowerCase());
              const chip=document.createElement('div'); chip.className='secondline-chip';
              
                if(!m || !m.EMPLOYEE_IMAGE){
                    // If no match OR no image URL, use a placeholder chip without an image
                    chip.innerHTML = `<div><div class="sname">${sec}</div><div class="smeta" style="color:#c23a3a;font-weight:700;font-size:.84rem;">(No image/data found)</div></div>`;
              } else {
                    // 2. SECOND-LINE EMPLOYEE IMAGE: Only create image element if URL exists
                    const img2=document.createElement('img'); 
                    img2.src=m.EMPLOYEE_IMAGE; 
                    img2.alt=m.EMPLOYEE_NAME;
                    attachPreview(img2, m); 
                    
                    const txtWrap=document.createElement('div'); txtWrap.style.display='flex'; txtWrap.style.flexDirection='column';
                    const sn=document.createElement('div'); sn.className='sname'; sn.textContent=m.EMPLOYEE_NAME;
                    const scode=document.createElement('div'); scode.className='code'; scode.textContent=m.EMPLOYEE_CODE||'';
                    const sm=document.createElement('div'); sm.className='smeta'; sm.textContent=m.ROLES||'';
                    txtWrap.append(sn, scode, sm);
                    
                    if(m.CUSTOMER && m.CUSTOMER.length){
                      const custWrap=document.createElement('div'); custWrap.style.marginTop='6px';
                      m.CUSTOMER.forEach(citem=>{ citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{ const cchip=document.createElement('span'); cchip.className='customer-chip'; cchip.textContent=s; custWrap.appendChild(cchip); }); });
                      txtWrap.appendChild(custWrap);
                    }
                    chip.append(img2, txtWrap);
              }
              row.appendChild(chip);
            });
            cb.appendChild(row);
          }
          wrap.appendChild(cb);
        });
        if(wrap.children.length) card.appendChild(wrap);
      }
    }


    contentArea.appendChild(card);
  });
}

// Image Modal Handler (existing)
function attachPreview(imgEl, emp){
    // Mouse Enter (with delay)
    imgEl.addEventListener('mouseenter', () => { 
        clearTimeout(hoverTimer);
        modalContent.src = imgEl.src;
        hoverTimer = setTimeout(() => {
            if (imgEl.matches(':hover')) {
                imageModal.classList.add('visible');
                imageModal.style.display = 'flex';
            }
        }, HOVER_DELAY_MS);
    });

    // Mouse Leave (clear delay and close modal)
    imgEl.addEventListener('mouseleave', () => {
        clearTimeout(hoverTimer); 
        if (imageModal.classList.contains('visible') && !modalContent.matches(':hover')) {
            closeImageModal();
        }
    });
}

document.addEventListener('DOMContentLoaded', ()=>{
    closeImageModal();
    closePdfModal(); // Initialize the PDF modal as closed
}); 

filterInput.addEventListener('input',()=>{ updateUI(); render(); });
loadJSON();
</script>
</body>
</html>
