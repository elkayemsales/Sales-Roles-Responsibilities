<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sales Team Roles & Responsibilities</title>
<link rel="icon" type="image/x-icon" href="favicon.png">

<style>
* { box-sizing:border-box; margin:0; padding:0; }
body, html { font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif; background:#fff9f4; color:#4b433b; }
#sidebarToggleBtn { position:fixed; top:16px; right:16px; z-index:1600; padding:12px 16px; border-radius:50px; cursor:pointer; background:#e9dcca; font-weight:700; }
#sidebar { position:fixed; top:0; left:0; bottom:0; width:320px; max-width:90%; background:#f7efe6; padding:20px; border-right:1px solid #d7c6a6; border-radius:0 10px 10px 0; display:flex; flex-direction:column; gap:12px; transform:translateX(-100%); transition:transform .28s ease; z-index:1500; overflow-y:auto; }
#sidebar.open { transform:translateX(0); }
.overlay { position:fixed; inset:0; background:rgba(0,0,0,0.28); z-index:1400; display:none; }
.overlay.visible { display:block; }
#main { padding:28px; transition:margin-left .28s ease; }
#main.shifted { margin-left:320px; }
h1 { font-size:1.8rem; margin-bottom:12px; color:#6b5e4a; }
.employee-card { background:#f3e9d6; border-radius:14px; padding:18px; margin-bottom:22px; box-shadow:0 3px 10px rgba(107,94,74,0.1); }
.employee-top { display:flex; gap:16px; align-items:center; }
.employee-top img { width:90px; height:90px; border-radius:12px; object-fit:cover; border:3px solid #d7c6a6; background:#f8f4ed; flex-shrink:0; }
.employee-top .meta { display:flex; flex-direction:column; gap:5px; }
.employee-top h3 { margin:0; font-size:1.15rem; font-weight:700; }
.employee-top .code { font-weight:700; font-size:.96rem; }
.employee-top small { color:#8b7b5a; font-weight:600; }
.customer-follow { margin-top:10px; background:#e3f5e3; border-left:4px solid #5ca65c; padding:8px 10px; border-radius:8px; }
.customer-follow strong { display:block; margin-bottom:6px; color:#2f6b2f; }
.customer-chip { display:inline-block; margin:4px 6px 0 0; background:#c4edc4; color:#2f6b2f; padding:4px 8px; border-radius:8px; font-weight:600; font-size:.9rem; }
.authorities { margin-top:10px; background:#fff4d6; border-left:4px solid #d9b65b; padding:8px 10px; border-radius:8px; display:flex; gap:8px; flex-wrap:wrap; }
.authority-chip { background:#f9e4a9; padding:6px 8px; border-radius:8px; font-weight:600; font-size:.88rem; }
.children-wrap { margin-top:12px; display:flex; flex-direction:column; gap:10px; }
.child-block { background:#fffef7; border:1.2px solid #e6dbc3; padding:10px; border-radius:10px; display:flex; flex-direction:column; gap:8px; }
.child-top { display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }
.resp { font-weight:700; }
.contrib { font-size:.92rem; color:#8b7b5a; font-weight:600; background:#f2e9d3; padding:6px 8px; border-radius:8px; }
.secondline-row { display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; }
.secondline-chip { display:flex; align-items:flex-start; gap:10px; background:#fff; border:1px solid #d7c6a6; padding:8px 10px; border-radius:10px; min-width:160px; flex:1 1 auto; flex-direction:row; }
.secondline-chip img { width:52px; height:52px; border-radius:10px; object-fit:cover; border:2px solid #d7c6a6; background:#f7f1e8; }
.sname { font-weight:700; color:#5b4e3d; }
.smeta { font-size:.84rem; color:#8b7b5a; }
.img-preview { position:fixed; z-index:3000; display:none; padding:6px; background:#fff; border-radius:8px; box-shadow:0 6px 30px rgba(0,0,0,0.25); max-width:240px; max-height:240px; overflow:hidden; transition:opacity .18s ease; }
.img-preview img { width:100%; height:auto; display:block; border-radius:6px; object-fit:contain; }
.filter-btn { background:#fef8f3; border:1.6px solid #d7c6a6; padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600; text-align:left; display:block; margin-bottom:6px; width:100%; }
.filter-btn.active { background:#b3a17a; color:#fff9f4; border-color:#9b8958; box-shadow:0 4px 10px #9b895822; }
#clearFilterBtn { background:#f2d1a9; border:0; padding:10px; width:100%; border-radius:10px; font-weight:700; cursor:pointer; margin-bottom:12px; }
#clearFilterBtn:disabled { opacity:0.55; cursor:not-allowed; }
#backToTop { position:fixed; bottom:30px; right:30px; padding:12px 16px; background:#e9dcca; border-radius:50px; cursor:pointer; display:none; z-index:1700; font-weight:700; }
#viewToggleBtn { background:#d9c6a2; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; width:100%; margin-bottom:12px; text-align:center; }
#filterInput { width:100%; padding:10px; border-radius:10px; border:1.6px solid #d7c6a6; margin-bottom:12px; background:#fff4e6; color:#4b433b; }
.filter-block h2 { font-size:1rem; margin-bottom:6px; color:#6b5e4a; }
</style>
</head>
<body>

<button id="sidebarToggleBtn">☰</button>
<div class="overlay" id="overlay"></div>

<aside id="sidebar">
  <input id="filterInput" type="search" placeholder="Search name, code, dept, customer...">
  <button id="viewToggleBtn">Switch to Basic View</button>
  <button id="clearFilterBtn" disabled>Clear filters</button>
  <div class="filter-block">
    <h2>Filter by Customer</h2>
    <div id="customerFilters"></div>
  </div>
  <div class="filter-block">
    <h2>Filter by Role</h2>
    <div id="roleFilters"></div>
  </div>
  <div class="filter-block">
    <h2>Filter by Contribution</h2>
    <div id="contribFilters"></div>
  </div>
</aside>

<main id="main">
  <h1>Sales Team Roles & Responsibilities</h1>
  <div id="contentArea"></div>
</main>

<div class="img-preview" id="imgPreview"><img id="imgPreviewImg"></div>
<button id="backToTop">Back to Top ↑</button>

<script>
const sidebarBtn = document.getElementById('sidebarToggleBtn');
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const contentArea = document.getElementById('contentArea');
const roleFiltersDiv = document.getElementById('roleFilters');
const contribFiltersDiv = document.getElementById('contribFilters');
const customerFiltersDiv = document.getElementById('customerFilters');
const filterInput = document.getElementById('filterInput');
const clearBtn = document.getElementById('clearFilterBtn');
const imgPreview = document.getElementById('imgPreview');
const imgPreviewImg = document.getElementById('imgPreviewImg');
const backToTop = document.getElementById('backToTop');
const viewToggleBtn = document.getElementById('viewToggleBtn');
const main = document.getElementById('main');

let data=[], activeRole=null, activeContrib=null, activeCustomer=null, basicView=false;
let nameIndex=new Map();

// Sidebar toggle
sidebarBtn.onclick = ()=>{
  sidebar.classList.toggle('open'); 
  overlay.classList.toggle('visible');
  main.classList.toggle('shifted');
};
overlay.onclick = ()=>{
  sidebar.classList.remove('open'); 
  overlay.classList.remove('visible'); 
  main.classList.remove('shifted');
};

// Back to Top button
window.addEventListener('scroll',()=>{ backToTop.style.display = window.scrollY>200?'block':'none'; });
backToTop.onclick = ()=>{ window.scrollTo({ top:0, behavior:'smooth' }); };

// Load JSON
async function loadJSON(){
  const res = await fetch('Data.json');
  data = await res.json();
  data.forEach(d=>{
    if(!Array.isArray(d.AUTHORITIES)) d.AUTHORITIES = d.AUTHORITIES ? [d.AUTHORITIES] : [];
    if(!Array.isArray(d.CHILDREN)) d.CHILDREN = d.CHILDREN||[];
    if(!Array.isArray(d.CUSTOMER)) d.CUSTOMER = d.CUSTOMER ? (Array.isArray(d.CUSTOMER)?d.CUSTOMER:[d.CUSTOMER]) : [];
    // Normalize for second-line matching
    nameIndex.set((d.EMPLOYEE_NAME||'').toLowerCase(), d);
  });
  buildFilters();
  render();
}

// Build filters dynamically
function buildFilters(){
  // Roles
  const roles=[...new Set(data.map(d=>d.ROLES).filter(Boolean))];
  roleFiltersDiv.innerHTML='';
  roles.forEach(r=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=r;
    b.onclick=()=>{ activeRole = activeRole===r?null:r; updateUI(); render(); };
    roleFiltersDiv.appendChild(b);
  });

  // Contribution
  const contribs=[...new Set(data.flatMap(d=>d.CHILDREN.map(c=>c['SALES ACTIVITIES CONTRIBUTION']).filter(Boolean)))];
  contribFiltersDiv.innerHTML='';
  contribs.forEach(c=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
    b.onclick=()=>{ activeContrib = activeContrib===c?null:c; updateUI(); render(); };
    contribFiltersDiv.appendChild(b);
  });

  // Customers (split and unique)
  const custSet=new Set();
  data.forEach(d=>{
    d.CUSTOMER.forEach(c=>{
      c.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>custSet.add(s));
    });
  });
  customerFiltersDiv.innerHTML='';
  Array.from(custSet).sort().forEach(c=>{
    const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
    b.onclick=()=>{ activeCustomer = activeCustomer===c?null:c; updateUI(); render(); };
    customerFiltersDiv.appendChild(b);
  });

  updateUI();
}

// Update UI active classes
function updateUI(){
  [...roleFiltersDiv.children].forEach(b=>b.classList.toggle('active', b.textContent===activeRole));
  [...contribFiltersDiv.children].forEach(b=>b.classList.toggle('active', b.textContent===activeContrib));
  [...customerFiltersDiv.children].forEach(b=>b.classList.toggle('active', b.textContent===activeCustomer));
  clearBtn.disabled = !(activeRole||activeContrib||activeCustomer||filterInput.value.trim().length>0);
}
clearBtn.onclick = ()=>{ activeRole=activeContrib=activeCustomer=null; filterInput.value=''; updateUI(); render(); };

// Basic/Full view toggle
viewToggleBtn.onclick = ()=>{
  basicView = !basicView;
  viewToggleBtn.textContent = basicView ? 'Switch to Full View' : 'Switch to Basic View';
  render();
};

// Render employee cards
function render(){
  const q = filterInput.value.trim().toLowerCase();
  let visible = data.slice();
  if(activeRole) visible = visible.filter(d=>d.ROLES===activeRole);
  if(activeContrib) visible = visible.filter(d=>d.CHILDREN.some(c=>c['SALES ACTIVITIES CONTRIBUTION']===activeContrib));
  if(activeCustomer) visible = visible.filter(d=>d.CUSTOMER.some(c=>c.split(/[\/,;\|]+/).map(x=>x.trim().toLowerCase()).includes(activeCustomer.toLowerCase())));
  if(q) visible = visible.filter(d=>{
    const top = (d.EMPLOYEE_NAME+' '+d.EMPLOYEE_CODE+' '+d.ROLES+' '+(d.DEPARTMENT||'')).toLowerCase();
    const auth = d.AUTHORITIES.some(a=>a.toLowerCase().includes(q));
    const child = d.CHILDREN.some(c=>((c.RESPONSIBILITIES||'')+' '+(c['SALES ACTIVITIES CONTRIBUTION']||'')).toLowerCase().includes(q));
    const cust = d.CUSTOMER.some(c=>c.toLowerCase().includes(q));
    return top.includes(q)||auth||child||cust;
  });

  contentArea.innerHTML='';
  if(!visible.length){ contentArea.innerHTML='<p>No matching records found.</p>'; return; }

  visible.forEach(emp=>{
    const card=document.createElement('div'); card.className='employee-card';
    const top=document.createElement('div'); top.className='employee-top';
    const img=document.createElement('img'); img.src=emp.EMPLOYEE_IMAGE||'https://via.placeholder.com/90?text=No'; img.alt=emp.EMPLOYEE_NAME;
    attachPreview(img, emp);
    const meta=document.createElement('div'); meta.className='meta';
    meta.innerHTML = `<h3>${emp.EMPLOYEE_NAME}</h3><div class="code">${emp.EMPLOYEE_CODE||''}</div><small>${emp.ROLES||''}</small><small>Dept: ${emp.DEPARTMENT||'-'}</small>`;
    top.append(img, meta); card.appendChild(top);

    // Always show customer in basic and full
    if(emp.CUSTOMER.length){
      const cDiv=document.createElement('div'); cDiv.className='customer-follow';
      cDiv.innerHTML = '<strong>Customer Follow-ups:</strong>';
      emp.CUSTOMER.forEach(citem=>{
        citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{
          const chip=document.createElement('span'); chip.className='customer-chip'; chip.textContent=s; cDiv.appendChild(chip);
        });
      });
      card.appendChild(cDiv);
    }

    // Full view sections
    if(!basicView){
      if(emp.AUTHORITIES.length){
        const aDiv=document.createElement('div'); aDiv.className='authorities';
        emp.AUTHORITIES.forEach(a=>{ const chip=document.createElement('div'); chip.className='authority-chip'; chip.textContent=a; aDiv.appendChild(chip); });
        card.appendChild(aDiv);
      }
      if(emp.CHILDREN.length){
        const wrap=document.createElement('div'); wrap.className='children-wrap';
        emp.CHILDREN.forEach(child=>{
          if(child['SECONDLINE PERSON'] && child['SECONDLINE PERSON'].startsWith('****')) return;
          const cb=document.createElement('div'); cb.className='child-block';
          const ctop=document.createElement('div'); ctop.className='child-top';
          const resp=document.createElement('div'); resp.className='resp'; resp.textContent=child.RESPONSIBILITIES||'—';
          const contrib=document.createElement('div'); contrib.className='contrib'; contrib.textContent=child['SALES ACTIVITIES CONTRIBUTION']||'';
          ctop.append(resp, contrib); cb.appendChild(ctop);

          const secsRaw = (child['SECONDLINE PERSON']||'').split(/[\/,;\|]+/).map(s=>s.trim()).filter(Boolean);
          if(secsRaw.length){
            const row=document.createElement('div'); row.className='secondline-row';
            secsRaw.forEach(sec=>{
              const m = nameIndex.get((sec||'').toLowerCase());
              const chip=document.createElement('div'); chip.className='secondline-chip';
              if(!m){
                chip.innerHTML = `<img src="https://via.placeholder.com/52?text=?" alt="?"><div><div class="sname">${sec}</div><div class="smeta" style="color:#c23a3a;font-weight:700;font-size:.84rem;">Not found</div></div>`;
                row.appendChild(chip); return;
              }
              const img2=document.createElement('img'); img2.src=m.EMPLOYEE_IMAGE||'https://via.placeholder.com/52?text=No'; img2.alt=m.EMPLOYEE_NAME;
              attachPreview(img2, m);
              const txtWrap=document.createElement('div'); txtWrap.style.display='flex'; txtWrap.style.flexDirection='column';
              const sn=document.createElement('div'); sn.className='sname'; sn.textContent=m.EMPLOYEE_NAME;
              const scode=document.createElement('div'); scode.className='code'; scode.textContent=m.EMPLOYEE_CODE||'';
              const sm=document.createElement('div'); sm.className='smeta'; sm.textContent=m.ROLES||'';
              txtWrap.append(sn, scode, sm);
              if(m.CUSTOMER && m.CUSTOMER.length){
                const custWrap=document.createElement('div'); custWrap.style.marginTop='6px';
                m.CUSTOMER.forEach(citem=>{ citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{ const cchip=document.createElement('span'); cchip.className='customer-chip'; cchip.textContent=s; custWrap.appendChild(cchip); }); });
                txtWrap.appendChild(custWrap);
              }
              chip.append(img2, txtWrap); row.appendChild(chip);
            });
            cb.appendChild(row);
          }
          wrap.appendChild(cb);
        });
        if(wrap.children.length) card.appendChild(wrap);
      }
    }

    contentArea.appendChild(card);
  });
}

// Image hover preview
function attachPreview(imgEl, emp){
  imgEl.addEventListener('mouseenter',()=>{ 
    imgPreviewImg.src=emp.EMPLOYEE_IMAGE||imgEl.src; 
    imgPreview.style.display='block'; 
    const rect=imgEl.getBoundingClientRect(); 
    imgPreview.style.left=Math.min(rect.right+8, window.innerWidth-260)+'px'; 
    imgPreview.style.top=Math.min(rect.top, window.innerHeight-260)+'px'; 
    imgPreview.style.opacity='1'; 
  });
  imgEl.addEventListener('mouseleave',()=>{ 
    imgPreview.style.opacity='0'; 
    setTimeout(()=>{imgPreview.style.display='none';},180); 
  });
}

filterInput.addEventListener('input',()=>render());
loadJSON();
</script>
</body>
</html>


