<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sales Team Roles & Responsibilities</title>
<link rel="icon" type="image/x-icon" href="favicon.png">
<style>
* { box-sizing:border-box; margin:0; padding:0; }
body, html { font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif; background:#fff9f4; color:#4b433b; }

/* --- Fixed Controls --- */
#sidebarToggleBtn { position:fixed; top:16px; right:16px; z-index:1600; padding:12px 16px; border-radius:50px; cursor:pointer; background:#e9dcca; font-weight:700; }
#viewToggleBtn { position:fixed; top:16px; right:90px; z-index:1600; padding:12px 16px; border-radius:50px; cursor:pointer; background:#d9c6a2; font-weight:700; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
#backToTop { position:fixed; bottom:30px; right:30px; padding:12px 16px; background:#e9dcca; border-radius:50px; cursor:pointer; display:none; z-index:1700; font-weight:700; }

/* --- Sidebar & Main Content --- */
#sidebar { 
    position:fixed; top:0; left:0; bottom:0; width:320px; max-width:90%; 
    background:#f7efe6; padding:20px; border-right:1px solid #d7c6a6; 
    border-radius:0 10px 10px 0; display:flex; flex-direction:column; 
    gap:12px; transform:translateX(-100%); transition:transform .28s ease; 
    z-index:1500; overflow-y:auto; 
}
#sidebar.open { transform:translateX(0); }

#main { padding:28px; transition:margin-left .28s ease; }
#main.shifted { margin-left:320px; }
h1 { font-size:1.8rem; margin-bottom:12px; color:#6b5e4a; }

/* --- Card Styling --- */
.employee-card { background:#f3e9d6; border-radius:14px; padding:18px; margin-bottom:22px; box-shadow:0 3px 10px rgba(107,94,74,0.1); }
.employee-top { display:flex; gap:16px; align-items:center; }
/* IMAGE STYLE 1: Main Employee Image */
.employee-top img { 
    width:90px; height:90px; border-radius:12px; 
    object-fit:cover; /* *** ENSURES CROP TO FIT *** */
    border:3px solid #d7c6a6; background:#f8f4ed; flex-shrink:0; 
    cursor: pointer; 
}
.employee-top .meta { display:flex; flex-direction:column; gap:5px; }
.employee-top h3 { margin:0; font-size:1.15rem; font-weight:700; }
.employee-top .code { font-weight:700; font-size:.96rem; }
.employee-top small { color:#8b7b5a; font-weight:600; }
.customer-follow { margin-top:10px; background:#e3f5e3; border-left:4px solid #5ca65c; padding:8px 10px; border-radius:8px; }
.customer-follow strong { display:block; margin-bottom:6px; color:#2f6b2f; }
.customer-chip { display:inline-block; margin:4px 6px 0 0; background:#c4edc4; color:#2f6b2f; padding:4px 8px; border-radius:8px; font-weight:600; font-size:.9rem; }
.authorities { margin-top:10px; background:#fff4d6; border-left:4px solid #d9b65b; padding:8px 10px; border-radius:8px; display:flex; gap:8px; flex-wrap:wrap; }
.authority-chip { background:#f9e4a9; padding:6px 8px; border-radius:8px; font-weight:600; font-size:.88rem; }
.children-wrap { margin-top:12px; display:flex; flex-direction:column; gap:10px; }
.child-block { background:#fffef7; border:1.2px solid #e6dbc3; padding:10px; border-radius:10px; display:flex; flex-direction:column; gap:8px; }
.child-top { display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }
.resp { font-weight:700; }
.contrib { font-size:.92rem; color:#8b7b5a; font-weight:600; background:#f2e9d3; padding:6px 8px; border-radius:8px; }
.secondline-row { display:flex; flex-wrap:wrap; gap:12px; margin-top:6px; }
.secondline-chip { display:flex; align-items:flex-start; gap:10px; background:#fff; border:1px solid #d7c6a6; padding:8px 10px; border-radius:10px; min-width:160px; flex:1 1 auto; flex-direction:row; }
/* IMAGE STYLE 2: Second-Line Image */
.secondline-chip img { 
    width:52px; height:52px; border-radius:10px; 
    object-fit:cover; /* *** ENSURES CROP TO FIT *** */
    border:2px solid #d7c6a6; background:#f7f1e8; 
    cursor: pointer; 
}
.sname { font-weight:700; color:#5b4e3d; }
.smeta { font-size:.84rem; color:#8b7b5a; }

/* --- Filtering UI --- */
.filter-btn { background:#fef8f3; border:1.6px solid #d7c6a6; padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600; text-align:left; display:block; margin-bottom:6px; width:100%; }
.filter-btn.active { background:#b3a17a; color:#fff9f4; border-color:#9b8958; box-shadow:0 4px 10px #9b895822; }
#clearFilterBtn { background:#f2d1a9; border:0; padding:10px; width:100%; border-radius:10px; font-weight:700; cursor:pointer; margin-bottom:12px; }
#clearFilterBtn:disabled { opacity:0.55; cursor:not-allowed; }
#filterInput { width:100%; padding:10px; border-radius:10px; border:1.6px solid #d7c6a6; margin-bottom:12px; background:#fff4e6; color:#4b433b; }
.filter-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.filter-header h2 { font-size:1rem; color:#6b5e4a; margin:0; }
.clear-individual-btn { 
    background: #d7c6a6; color: #fff; border: none; border-radius: 5px; 
    padding: 2px 6px; font-size: 0.8rem; font-weight: 700; cursor: pointer;
    line-height: 1; 
}
.clear-individual-btn:disabled { 
    background: #e9e5de; cursor: not-allowed; 
}

/* --- New Image Modal Styles --- */
#imageModal {
    display: none; /* Key: Ensure it starts hidden */
    position: fixed; 
    z-index: 5000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    background-color: rgba(0,0,0,0.85); 
    align-items: center;
    justify-content: center;
    pointer-events: none; 
}
#imageModal.visible {
    display: flex;
    pointer-events: auto; 
}

/* IMAGE STYLE 3: Modal Image */
#modalContent {
    width: 90%;
    max-width: 700px;
    max-height: 90vh; 
    object-fit: contain; 
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    background: #fff; 
    pointer-events: auto; 
}
</style>
</head>
<body>

<button id="viewToggleBtn">ğŸ” **Basic**</button>
<button id="sidebarToggleBtn">â˜°</button>

<aside id="sidebar">
Â  <input id="filterInput" type="search" placeholder="Search name, code, dept, customer...">
Â  <button id="clearFilterBtn" disabled>Clear ALL filters</button>
Â  
Â  <div class="filter-block">
Â  Â  <div class="filter-header">
Â  Â  Â  <h2>Filter by Customer (Multi-Select)</h2>
Â  Â  Â  <button id="clearCustomerBtn" class="clear-individual-btn" disabled>âŒ</button>
Â  Â  </div>
Â  Â  <div id="customerFilters"></div>
Â  </div>
Â  
Â  <div class="filter-block">
Â  Â  <div class="filter-header">
Â  Â  Â  <h2>Filter by Role (Single-Select)Â </h2>
Â  Â  Â  <button id="clearRoleBtn" class="clear-individual-btn" disabled>âŒ</button>
Â  Â  </div>
Â  Â  <div id="roleFilters"></div>
Â  </div>
Â  
Â  <div class="filter-block">
Â  Â  <div class="filter-header">
Â  Â  Â  <h2>Filter by Contribution (Multi-Select)</h2>
Â  Â  Â  <button id="clearContribBtn" class="clear-individual-btn" disabled>âŒ</button>
Â  Â  </div>
Â  Â  <div id="contribFilters"></div>
Â  </div>
</aside>

<main id="main">
Â  <h1>Sales Team Roles & Responsibilities</h1>
Â  <div id="contentArea"></div>
</main>

<div id="imageModal">
    <img id="modalContent" alt="Employee Photo">
</div>

<button id="backToTop">Back to Top â†‘</button>

<script>
const sidebarBtn = document.getElementById('sidebarToggleBtn');
const sidebar = document.getElementById('sidebar');
const contentArea = document.getElementById('contentArea');
const roleFiltersDiv = document.getElementById('roleFilters');
const contribFiltersDiv = document.getElementById('contribFilters');
const customerFiltersDiv = document.getElementById('customerFilters');
const filterInput = document.getElementById('filterInput');
const clearBtn = document.getElementById('clearFilterBtn'); 
const clearRoleBtn = document.getElementById('clearRoleBtn');
const clearCustomerBtn = document.getElementById('clearCustomerBtn');
const clearContribBtn = document.getElementById('clearContribBtn');
const backToTop = document.getElementById('backToTop');
const viewToggleBtn = document.getElementById('viewToggleBtn');
const main = document.getElementById('main');

// Image Modal Elements
const imageModal = document.getElementById('imageModal');
const modalContent = document.getElementById('modalContent');

let data=[], activeRole=null, activeContrib=[], activeCustomer=[], basicView=true; 
let nameIndex=new Map();

// --- Global Variable for Hover Delay ---
let hoverTimer = null; 
const HOVER_DELAY_MS = 300; // 0.3 seconds

// --- Event Listeners for Controls ---

// Sidebar toggle
sidebarBtn.onclick = ()=>{
Â  sidebar.classList.toggle('open');Â 
Â  main.classList.toggle('shifted');
};

// Back to Top button
window.addEventListener('scroll',()=>{ backToTop.style.display = window.scrollY>200?'block':'none'; });
backToTop.onclick = ()=>{ window.scrollTo({ top:0, behavior:'smooth' }); };

// View toggle
viewToggleBtn.onclick = ()=>{
Â  basicView = !basicView;
Â  viewToggleBtn.innerHTML = basicView ? 'ğŸ” **Basic**' : 'ğŸ“‚ **Expanded**';
Â  render();
};
viewToggleBtn.innerHTML = basicView ? 'ğŸ” **Basic**' : 'ğŸ“‚ **Expanded**';

// Clear ALL filters button
clearBtn.onclick = ()=>{ 
Â  activeRole=null; 
Â  activeContrib=[]; 
Â  activeCustomer=[]; 
Â  filterInput.value=''; 
Â  updateUI(); 
Â  render(); 
};

// Clear Individual Filter buttons
clearRoleBtn.onclick = ()=>{ activeRole=null; updateUI(); render(); };
clearCustomerBtn.onclick = ()=>{ activeCustomer=[]; updateUI(); render(); };
clearContribBtn.onclick = ()=>{ activeContrib=[]; updateUI(); render(); };

// Function to close the modal
function closeModal() {
    imageModal.classList.remove('visible');
    // Ensure display: none is explicitly set
    imageModal.style.display = 'none'; 
}

// Close modal on click outside content or mouse leave from the modal itself
imageModal.addEventListener('click', (e) => {
    // Only close if the click target is the modal backdrop itself, not the image content
    if (e.target === imageModal) {
        closeModal();
    }
});

// Close modal immediately if the mouse leaves the modal image
modalContent.addEventListener('mouseleave', closeModal);

// Close modal on Escape key press
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && imageModal.classList.contains('visible')) {
        closeModal();
    }
});

// --- Data and Rendering Logic ---

// Define the custom role hierarchy
const customRoleOrder = {
  'HEAD OF THE DEPARTMENT': 1,
  'SR.OFFICER': 2,
  'OFFICER': 3,
  'JR.OFFICER': 4,
  'OPERATOR': 5,
  'AD.OPERATOR': 6,
  'AD.TRAINEE': 7
};

// Load JSON
async function loadJSON(){
Â  const res = await fetch('Data.json');
Â  data = await res.json();
Â  
Â  // --- Custom Sorting Logic ---
Â  data.sort((a, b) => {
Â  Â  const roleA = (a.ROLES || '').toUpperCase();
Â  Â  const roleB = (b.ROLES || '').toUpperCase();
Â  Â  const rankA = customRoleOrder[roleA] || 999;
Â  Â  const rankB = customRoleOrder[roleB] || 999;

Â  Â  if (rankA !== rankB) {
Â  Â  Â  return rankA - rankB;
Â  Â  }

Â  Â  const codeA = (a.EMPLOYEE_CODE || '').toUpperCase();
Â  Â  const codeB = (b.EMPLOYEE_CODE || '').toUpperCase();
Â  Â  if (codeA < codeB) return -1;
Â  Â  if (codeA > codeB) return 1;
Â  Â  
Â  Â  return 0;
Â  });

Â  data.forEach(d=>{
Â  Â  if(!Array.isArray(d.AUTHORITIES)) d.AUTHORITIES = d.AUTHORITIES ? [d.AUTHORITIES] : [];
Â  Â  if(!Array.isArray(d.CHILDREN)) d.CHILDREN = d.CHILDREN||[];
Â  Â  if(!Array.isArray(d.CUSTOMER)) d.CUSTOMER = d.CUSTOMER ? (Array.isArray(d.CUSTOMER)?d.CUSTOMER:[d.CUSTOMER]) : [];
Â  Â  nameIndex.set((d.EMPLOYEE_NAME||'').toLowerCase(), d);
Â  });
Â  buildFilters();
Â  render();
}

// Build filters dynamically
function buildFilters(){
Â  // Roles (Single Select)
Â  const roles=[...new Set(data.map(d=>d.ROLES).filter(Boolean))];
Â  roleFiltersDiv.innerHTML='';
Â  roles.forEach(r=>{
Â  Â  const b=document.createElement('button'); b.className='filter-btn'; b.textContent=r;
Â  Â  b.onclick=()=>{ activeRole = activeRole===r?null:r; updateUI(); render(); };
Â  Â  roleFiltersDiv.appendChild(b);
Â  });

Â  // Contribution (Multi Select)
Â  const contribs=[...new Set(data.flatMap(d=>d.CHILDREN.map(c=>c['SALES ACTIVITIES CONTRIBUTION']).filter(Boolean)))];
Â  contribFiltersDiv.innerHTML='';
Â  contribs.forEach(c=>{
Â  Â  const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
Â  Â  b.onclick=()=>{ 
Â  Â  Â  toggleSelection(activeContrib, c);
Â  Â  Â  updateUI(); 
Â  Â  Â  render(); 
Â  Â  };
Â  Â  contribFiltersDiv.appendChild(b);
Â  });

Â  // Customers (Multi Select)
Â  const custSet=new Set();
Â  data.forEach(d=>{
Â  Â  d.CUSTOMER.forEach(c=>{
Â  Â  Â  c.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>custSet.add(s));
Â  Â  });
Â  });
Â  customerFiltersDiv.innerHTML='';
Â  Array.from(custSet).sort().forEach(c=>{
Â  Â  const b=document.createElement('button'); b.className='filter-btn'; b.textContent=c;
Â  Â  b.onclick=()=>{ 
Â  Â  Â  toggleSelection(activeCustomer, c);
Â  Â  Â  updateUI(); 
Â  Â  Â  render(); 
Â  Â  };
Â  Â  customerFiltersDiv.appendChild(b);
Â  });

Â  updateUI();
}

// Helper function for array toggling
function toggleSelection(arr, item) {
Â  const index = arr.indexOf(item);
Â  if (index > -1) {
Â  Â  arr.splice(index, 1);
Â  } else {
Â  Â  arr.push(item);
Â  }
}

// Update UI active classes and button states
function updateUI(){
Â  // Update filter button visual states
Â  [...roleFiltersDiv.children].forEach(b=>b.classList.toggle('active', b.textContent===activeRole));
Â  [...contribFiltersDiv.children].forEach(b=>b.classList.toggle('active', activeContrib.includes(b.textContent)));
Â  [...customerFiltersDiv.children].forEach(b=>b.classList.toggle('active', activeCustomer.includes(b.textContent)));
Â  
Â  // Update individual clear button states
Â  clearRoleBtn.disabled = !activeRole;
Â  clearCustomerBtn.disabled = activeCustomer.length === 0;
Â  clearContribBtn.disabled = activeContrib.length === 0;

Â  // Update 'Clear ALL' button state
Â  const isFilterActive = activeRole || activeCustomer.length > 0 || activeContrib.length > 0 || filterInput.value.trim().length > 0;
Â  clearBtn.disabled = !isFilterActive;
}

// Render employee cards
function render(){
Â  const q = filterInput.value.trim().toLowerCase();
Â  let visible = data.slice();
Â  
Â  // Apply filters...
Â  if(activeRole) visible = visible.filter(d=>d.ROLES===activeRole);
Â  
Â  // Filter by contribution: Must match at least one selected contribution in CHILDREN array
Â  if(activeContrib.length > 0) {
Â  Â  visible = visible.filter(d => 
Â  Â  Â  d.CHILDREN.some(c => activeContrib.includes(c['SALES ACTIVITIES CONTRIBUTION']))
Â  Â  );
Â  }
Â  
Â  if(activeCustomer.length > 0) {
Â  Â  visible = visible.filter(d => 
Â  Â  Â  d.CUSTOMER.some(citem => 
Â  Â  Â  Â  citem.split(/[\/,;\|]+/).map(x => x.trim())
Â  Â  Â  Â  .some(cName => activeCustomer.includes(cName))
Â  Â  Â  )
Â  Â  );
Â  }
Â  
Â  // Apply text search filter
Â  if(q) visible = visible.filter(d=>{
Â  Â  const top = (d.EMPLOYEE_NAME+' '+d.EMPLOYEE_CODE+' '+d.ROLES+' '+(d.DEPARTMENT||'')).toLowerCase();
Â  Â  const auth = d.AUTHORITIES.some(a=>a.toLowerCase().includes(q));
Â  Â  const child = d.CHILDREN.some(c=>((c.RESPONSIBILITIES||'')+' '+(c['SALES ACTIVITIES CONTRIBUTION']||'')).toLowerCase().includes(q));
Â  Â  const cust = d.CUSTOMER.some(c=>c.toLowerCase().includes(q));
Â  Â  return top.includes(q)||auth||child||cust;
Â  });

Â  contentArea.innerHTML='';
Â  if(!visible.length){ contentArea.innerHTML='<p>No matching records found.</p>'; return; }

Â  visible.forEach(emp=>{
Â  Â  const card=document.createElement('div'); card.className='employee-card';
Â  Â  const top=document.createElement('div'); top.className='employee-top';
Â  Â  
    const imgURL = emp.EMPLOYEE_IMAGE;

    // 1. MAIN EMPLOYEE IMAGE: Only create image element if URL exists
    if (imgURL) {
        const img = document.createElement('img'); 
        img.src = imgURL; 
        img.alt = emp.EMPLOYEE_NAME;
        attachPreview(img, emp); 
        top.append(img); // Append image
    }

Â  Â  const meta=document.createElement('div'); meta.className='meta';
    
    // Append image metadata (name, code, role)
Â  Â  meta.innerHTML = `<h3>${emp.EMPLOYEE_NAME}</h3><div class="code">${emp.EMPLOYEE_CODE||''}</div><small>${emp.ROLES||''}</small>`; 
Â  Â  top.append(meta); 
    card.appendChild(top);

Â  Â  if(emp.CUSTOMER.length){
Â  Â  Â  const cDiv=document.createElement('div'); cDiv.className='customer-follow';
Â  Â  Â  cDiv.innerHTML = '<strong>Customer Follow-ups:</strong>';
Â  Â  Â  emp.CUSTOMER.forEach(citem=>{
Â  Â  Â  Â  citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{
Â  Â  Â  Â  Â  const chip=document.createElement('span'); chip.className='customer-chip'; chip.textContent=s; cDiv.appendChild(chip);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  card.appendChild(cDiv);
Â  Â  }

Â  Â  // Full view sections (Only shown when basicView is false)
Â  Â  if(!basicView){
Â  Â  Â  if(emp.AUTHORITIES.length){
Â  Â  Â  Â  const aDiv=document.createElement('div'); aDiv.className='authorities';
Â  Â  Â  Â  emp.AUTHORITIES.forEach(a=>{ const chip=document.createElement('div'); chip.className='authority-chip'; chip.textContent=a; aDiv.appendChild(chip); });
Â  Â  Â  Â  card.appendChild(aDiv);
Â  Â  Â  }
Â  Â  Â  if(emp.CHILDREN.length){
Â  Â  Â  Â  const wrap=document.createElement('div'); wrap.className='children-wrap';
Â  Â  Â  Â  emp.CHILDREN.forEach(child=>{
Â  Â  Â  Â  Â  if(child['SECONDLINE PERSON'] && child['SECONDLINE PERSON'].startsWith('****')) return;
Â  Â  Â  Â  Â  const cb=document.createElement('div'); cb.className='child-block';
Â  Â  Â  Â  Â  const ctop=document.createElement('div'); ctop.className='child-top';
Â  Â  Â  Â  Â  const resp=document.createElement('div'); resp.className='resp'; resp.textContent=child.RESPONSIBILITIES||'â€”';
Â  Â  Â  Â  Â  const contrib=document.createElement('div'); contrib.className='contrib'; contrib.textContent=child['SALES ACTIVITIES CONTRIBUTION']||'';
Â  Â  Â  Â  Â  ctop.append(resp, contrib); cb.appendChild(ctop);

Â  Â  Â  Â  Â  const secsRaw = (child['SECONDLINE PERSON']||'').split(/[\/,;\|]+/).map(s=>s.trim()).filter(Boolean);
Â  Â  Â  Â  Â  if(secsRaw.length){
Â  Â  Â  Â  Â  Â  const row=document.createElement('div'); row.className='secondline-row';
Â  Â  Â  Â  Â  Â  secsRaw.forEach(sec=>{
Â  Â  Â  Â  Â  Â  Â  const m = nameIndex.get((sec||'').toLowerCase());
Â  Â  Â  Â  Â  Â  Â  const chip=document.createElement('div'); chip.className='secondline-chip';
Â  Â  Â  Â  Â  Â  Â  
                if(!m || !m.EMPLOYEE_IMAGE){
                    // If no match OR no image URL, use a placeholder chip without an image
Â  Â  Â  Â  Â  Â  Â  Â  Â    chip.innerHTML = `<div><div class="sname">${sec}</div><div class="smeta" style="color:#c23a3a;font-weight:700;font-size:.84rem;">(No image/data found)</div></div>`;
Â  Â  Â  Â  Â  Â  Â  } else {
                    // 2. SECOND-LINE EMPLOYEE IMAGE: Only create image element if URL exists
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const img2=document.createElement('img'); 
                    img2.src=m.EMPLOYEE_IMAGE; 
                    img2.alt=m.EMPLOYEE_NAME;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â attachPreview(img2, m); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
                    const txtWrap=document.createElement('div'); txtWrap.style.display='flex'; txtWrap.style.flexDirection='column';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const sn=document.createElement('div'); sn.className='sname'; sn.textContent=m.EMPLOYEE_NAME;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const scode=document.createElement('div'); scode.className='code'; scode.textContent=m.EMPLOYEE_CODE||'';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const sm=document.createElement('div'); sm.className='smeta'; sm.textContent=m.ROLES||'';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â txtWrap.append(sn, scode, sm);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
                    if(m.CUSTOMER && m.CUSTOMER.length){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const custWrap=document.createElement('div'); custWrap.style.marginTop='6px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â m.CUSTOMER.forEach(citem=>{ citem.split(/[\/,;\|]+/).map(x=>x.trim()).filter(Boolean).forEach(s=>{ const cchip=document.createElement('span'); cchip.className='customer-chip'; cchip.textContent=s; custWrap.appendChild(cchip); }); });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â txtWrap.appendChild(custWrap);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â chip.append(img2, txtWrap);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  row.appendChild(chip);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  cb.appendChild(row);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  wrap.appendChild(cb);
Â  Â  Â  Â  });
Â  Â  Â  Â  if(wrap.children.length) card.appendChild(wrap);
Â  Â  Â  }
Â  Â  }

Â  Â  contentArea.appendChild(card);
Â  });
}

// Image Modal Handler with 300ms delay and instant mouse-out close
function attachPreview(imgEl, emp){
    // Mouse Enter (with delay)
    imgEl.addEventListener('mouseenter', () => {Â 
        // Clear any existing timer to prevent multiple popups
        clearTimeout(hoverTimer);

        // Update the image source immediately so it's ready when the timer finishes
        modalContent.src = imgEl.src;

        // Set a new timer
        hoverTimer = setTimeout(() => {
            // ONLY show the modal if the mouse is *still* over the element after the delay
            if (imgEl.matches(':hover')) {
                imageModal.classList.add('visible');
                imageModal.style.display = 'flex';
            }
        }, HOVER_DELAY_MS);
    });

    // Mouse Leave (clear delay AND close modal if it was open)
    imgEl.addEventListener('mouseleave', () => {
        // Clear the timer (prevents delayed opening)
        clearTimeout(hoverTimer); 
        
        // Hide the modal immediately when leaving the small image, 
        // UNLESS the mouse immediately entered the large modal image area.
        setTimeout(() => {
            if (!imgEl.matches(':hover') && !modalContent.matches(':hover')) {
                closeModal();
            }
        }, 50); // 50ms buffer
    });
}

// FINAL CHANGE: Ensure modal is hidden immediately upon script execution/load
document.addEventListener('DOMContentLoaded', closeModal); 

filterInput.addEventListener('input',()=>{ updateUI(); render(); });
loadJSON();
</script>
</body>
</html>
